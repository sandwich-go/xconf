// Code generated by optiongen. DO NOT EDIT.
// optiongen: github.com/timestee/optiongen

package tests

import (
	"sync/atomic"
	"time"
	"unsafe"

	"github.com/sandwich-go/xconf/tests/redis"
)

// Config struct
type Config struct {
	HttpAddress     string          `xconf:"http_address"`
	Map1            map[string]int  `xconf:"map1"`
	MapNotLeaf      map[string]int  `xconf:"map_not_leaf" usage:"k,v使用,分割, 测试特殊符号：\"test\""`
	TimeDurations   []time.Duration `xconf:"time_durations" usage:"延迟队列"`
	DefaultEmptyMap map[string]int  `xconf:"default_empty_map"`
	Int64Slice      []int64         `xconf:"int64_slice"`
	Float64Slice    []float64       `xconf:"float64_slice"`
	Uin64Slice      []uint64        `xconf:"uin64_slice"`
	StringSlice     []string        `xconf:"string_slice"`
	ReadTimeout     time.Duration   `xconf:"read_timeout"`
	SubTest         SubTest         `xconf:"sub_test"`
	TestBool        bool            `xconf:"test_bool"`
	RedisAsPointer  *Redis          `xconf:"redis_as_pointer"`
	Redis           Redis           `xconf:"redis"`
	RedisTimeout    *RedisTimeout   `xconf:"redis_timeout"`
}

// SetOption apply single option
func (cc *Config) SetOption(opt ConfigOption) {
	_ = opt(cc)
}

// ApplyOption apply mutiple options
func (cc *Config) ApplyOption(opts ...ConfigOption) {
	for _, opt := range opts {
		_ = opt(cc)
	}
}

// GetSetOption apply new option and return the old optuon
// sample:
// old := cc.GetSetOption(WithTimeout(time.Second))
// defer cc.SetOption(old)
func (cc *Config) GetSetOption(opt ConfigOption) ConfigOption {
	return opt(cc)
}

// ConfigOption option func
type ConfigOption func(cc *Config) ConfigOption

// WithHttpAddress option func for HttpAddress
func WithHttpAddress(v string) ConfigOption {
	return func(cc *Config) ConfigOption {
		previous := cc.HttpAddress
		cc.HttpAddress = v
		return WithHttpAddress(previous)
	}
}

// WithMap1 option func for Map1
func WithMap1(v map[string]int) ConfigOption {
	return func(cc *Config) ConfigOption {
		previous := cc.Map1
		cc.Map1 = v
		return WithMap1(previous)
	}
}

// k,v使用,分割, 测试特殊符号：&#34;test&#34;
// WithMapNotLeaf option func for MapNotLeaf
func WithMapNotLeaf(v map[string]int) ConfigOption {
	return func(cc *Config) ConfigOption {
		previous := cc.MapNotLeaf
		cc.MapNotLeaf = v
		return WithMapNotLeaf(previous)
	}
}

// 延迟队列
// WithTimeDurations option func for TimeDurations
func WithTimeDurations(v ...time.Duration) ConfigOption {
	return func(cc *Config) ConfigOption {
		previous := cc.TimeDurations
		cc.TimeDurations = v
		return WithTimeDurations(previous...)
	}
}

// WithDefaultEmptyMap option func for DefaultEmptyMap
func WithDefaultEmptyMap(v map[string]int) ConfigOption {
	return func(cc *Config) ConfigOption {
		previous := cc.DefaultEmptyMap
		cc.DefaultEmptyMap = v
		return WithDefaultEmptyMap(previous)
	}
}

// WithInt64Slice option func for Int64Slice
func WithInt64Slice(v ...int64) ConfigOption {
	return func(cc *Config) ConfigOption {
		previous := cc.Int64Slice
		cc.Int64Slice = v
		return WithInt64Slice(previous...)
	}
}

// WithFloat64Slice option func for Float64Slice
func WithFloat64Slice(v ...float64) ConfigOption {
	return func(cc *Config) ConfigOption {
		previous := cc.Float64Slice
		cc.Float64Slice = v
		return WithFloat64Slice(previous...)
	}
}

// WithUin64Slice option func for Uin64Slice
func WithUin64Slice(v ...uint64) ConfigOption {
	return func(cc *Config) ConfigOption {
		previous := cc.Uin64Slice
		cc.Uin64Slice = v
		return WithUin64Slice(previous...)
	}
}

// WithStringSlice option func for StringSlice
func WithStringSlice(v ...string) ConfigOption {
	return func(cc *Config) ConfigOption {
		previous := cc.StringSlice
		cc.StringSlice = v
		return WithStringSlice(previous...)
	}
}

// WithReadTimeout option func for ReadTimeout
func WithReadTimeout(v time.Duration) ConfigOption {
	return func(cc *Config) ConfigOption {
		previous := cc.ReadTimeout
		cc.ReadTimeout = v
		return WithReadTimeout(previous)
	}
}

// WithSubTest option func for SubTest
func WithSubTest(v SubTest) ConfigOption {
	return func(cc *Config) ConfigOption {
		previous := cc.SubTest
		cc.SubTest = v
		return WithSubTest(previous)
	}
}

// WithTestBool option func for TestBool
func WithTestBool(v bool) ConfigOption {
	return func(cc *Config) ConfigOption {
		previous := cc.TestBool
		cc.TestBool = v
		return WithTestBool(previous)
	}
}

// WithRedisAsPointer option func for RedisAsPointer
func WithRedisAsPointer(v *Redis) ConfigOption {
	return func(cc *Config) ConfigOption {
		previous := cc.RedisAsPointer
		cc.RedisAsPointer = v
		return WithRedisAsPointer(previous)
	}
}

// WithRedis option func for Redis
func WithRedis(v Redis) ConfigOption {
	return func(cc *Config) ConfigOption {
		previous := cc.Redis
		cc.Redis = v
		return WithRedis(previous)
	}
}

// WithRedisTimeout option func for RedisTimeout
func WithRedisTimeout(v *RedisTimeout) ConfigOption {
	return func(cc *Config) ConfigOption {
		previous := cc.RedisTimeout
		cc.RedisTimeout = v
		return WithRedisTimeout(previous)
	}
}

// NewTestConfig(opts... ConfigOption) new Config
func NewTestConfig(opts ...ConfigOption) *Config {
	cc := newDefaultConfig()

	for _, opt := range opts {
		_ = opt(cc)
	}
	if watchDogConfig != nil {
		watchDogConfig(cc)
	}
	return cc
}

// InstallConfigWatchDog the installed func will called when NewTestConfig(opts... ConfigOption)  called
func InstallConfigWatchDog(dog func(cc *Config)) {
	watchDogConfig = dog
}

// watchDogConfig global watch dog
var watchDogConfig func(cc *Config)

// newDefaultConfig new default Config
func newDefaultConfig() *Config {
	cc := &Config{}

	for _, opt := range [...]ConfigOption{
		WithHttpAddress(":3001"),
		WithMap1(map[string]int{"test1": 100, "test2": 200}),
		WithMapNotLeaf(map[string]int{"test1": 100, "test2": 200}),
		WithTimeDurations([]time.Duration{time.Second, time.Second}...),
		WithDefaultEmptyMap(nil),
		WithInt64Slice([]int64{101, 202, 303}...),
		WithFloat64Slice([]float64{101.191, 202.202, 303.303}...),
		WithUin64Slice([]uint64{101, 202, 303}...),
		WithStringSlice([]string{"test1", "test2", "test3"}...),
		WithReadTimeout(time.Second * time.Duration(5)),
		WithSubTest(SubTest{}),
		WithTestBool(false),
		WithRedisAsPointer(&redis.Conf{}),
		WithRedis(redis.Conf{}),
		WithRedisTimeout(&redis.Timeout{}),
	} {
		_ = opt(cc)
	}

	return cc
}

// AtomicSetFunc used for XConf
func (cc *Config) AtomicSetFunc() func(interface{}) { return AtomicConfigSet }

// atomicConfig global *Config holder
var atomicConfig unsafe.Pointer

// AtomicConfigSet atomic setter for *Config
func AtomicConfigSet(update interface{}) {
	atomic.StorePointer(&atomicConfig, (unsafe.Pointer)(update.(*Config)))
}

// AtomicConfig return atomic *Config visitor
func AtomicConfig() ConfigVisitor {
	current := (*Config)(atomic.LoadPointer(&atomicConfig))
	if current == nil {
		atomic.CompareAndSwapPointer(&atomicConfig, nil, (unsafe.Pointer)(newDefaultConfig()))
		return (*Config)(atomic.LoadPointer(&atomicConfig))
	}
	return current
}

// all getter func
// GetHttpAddress return struct field: HttpAddress
func (cc *Config) GetHttpAddress() string { return cc.HttpAddress }

// GetMap1 return struct field: Map1
func (cc *Config) GetMap1() map[string]int { return cc.Map1 }

// GetMapNotLeaf return struct field: MapNotLeaf
func (cc *Config) GetMapNotLeaf() map[string]int { return cc.MapNotLeaf }

// GetTimeDurations return struct field: TimeDurations
func (cc *Config) GetTimeDurations() []time.Duration { return cc.TimeDurations }

// GetDefaultEmptyMap return struct field: DefaultEmptyMap
func (cc *Config) GetDefaultEmptyMap() map[string]int { return cc.DefaultEmptyMap }

// GetInt64Slice return struct field: Int64Slice
func (cc *Config) GetInt64Slice() []int64 { return cc.Int64Slice }

// GetFloat64Slice return struct field: Float64Slice
func (cc *Config) GetFloat64Slice() []float64 { return cc.Float64Slice }

// GetUin64Slice return struct field: Uin64Slice
func (cc *Config) GetUin64Slice() []uint64 { return cc.Uin64Slice }

// GetStringSlice return struct field: StringSlice
func (cc *Config) GetStringSlice() []string { return cc.StringSlice }

// GetReadTimeout return struct field: ReadTimeout
func (cc *Config) GetReadTimeout() time.Duration { return cc.ReadTimeout }

// GetSubTest return struct field: SubTest
func (cc *Config) GetSubTest() SubTest { return cc.SubTest }

// GetTestBool return struct field: TestBool
func (cc *Config) GetTestBool() bool { return cc.TestBool }

// GetRedisAsPointer return struct field: RedisAsPointer
func (cc *Config) GetRedisAsPointer() *Redis { return cc.RedisAsPointer }

// GetRedis return struct field: Redis
func (cc *Config) GetRedis() Redis { return cc.Redis }

// GetRedisTimeout return struct field: RedisTimeout
func (cc *Config) GetRedisTimeout() *RedisTimeout { return cc.RedisTimeout }

// ConfigVisitor visitor interface for Config
type ConfigVisitor interface {
	GetHttpAddress() string
	GetMap1() map[string]int
	GetMapNotLeaf() map[string]int
	GetTimeDurations() []time.Duration
	GetDefaultEmptyMap() map[string]int
	GetInt64Slice() []int64
	GetFloat64Slice() []float64
	GetUin64Slice() []uint64
	GetStringSlice() []string
	GetReadTimeout() time.Duration
	GetSubTest() SubTest
	GetTestBool() bool
	GetRedisAsPointer() *Redis
	GetRedis() Redis
	GetRedisTimeout() *RedisTimeout
}
